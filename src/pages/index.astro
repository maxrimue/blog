---
import Layout from "../layouts/Layout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { getCollection } from "astro:content";

const posts = (
  await getCollection("blog", ({ data }) => {
    if (import.meta.env.PROD) {
      return data.draft !== true;
    }
    return true;
  })
)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<Layout>
  <div class="max-w-2xl mx-auto">
    <section class="py-10">
      <h1 class="font-inter text-5xl sm:text-6xl tracking-tight leading-[1.05]">
        Hi, I'm Max
      </h1>
      <p class="mt-4 text-lg text-text-muted leading-relaxed max-w-lg">
        I write about web development, performance, and things I'm learning.
      </p>
    </section>

    <section class="pb-10">
      <div class="flex items-baseline justify-between mb-6">
        <h2 class="font-inter text-2xl tracking-tight">Latest posts</h2>
        <a
          href="/blog"
          class="text-sm text-accent hover:text-accent-hover transition-colors"
        >
          View all &rarr;
        </a>
      </div>

      {
        posts.length === 0 ? (
          <p class="text-text-muted">No posts yet. Check back soon.</p>
        ) : (
          <ul class="space-y-1">
            {posts.map((post) => (
              <li>
                <a
                  href={`/blog/${post.id}/`}
                  class="group flex items-baseline justify-between gap-4 py-3 border-b border-border transition-colors hover:border-accent"
                >
                  <span class="font-medium group-hover:text-accent transition-colors">
                    {post.data.title}
                  </span>
                  <span class="text-sm text-text-faint shrink-0 tabular-nums">
                    <FormattedDate date={post.data.pubDate} />
                  </span>
                </a>
              </li>
            ))}
          </ul>
        )
      }
    </section>

    <section class="pb-12">
      <h2 class="font-inter text-2xl tracking-tight mb-6">Elsewhere</h2>
      <nav class="flex flex-wrap gap-3">
        <a
          href="https://github.com/maxrimue"
          target="_blank"
          rel="noreferrer"
          class="px-4 py-2 text-sm border border-border rounded-full text-text-muted hover:text-accent hover:border-accent transition-colors"
        >
          GitHub
        </a>
        <a
          href="https://mastodon.social/@maxrimue"
          target="_blank"
          rel="noreferrer"
          class="px-4 py-2 text-sm border border-border rounded-full text-text-muted hover:text-accent hover:border-accent transition-colors"
        >
          Mastodon
        </a>
        <a
          href="https://www.linkedin.com/in/max-r-301b99113/"
          target="_blank"
          rel="noreferrer"
          class="px-4 py-2 text-sm border border-border rounded-full text-text-muted hover:text-accent hover:border-accent transition-colors"
        >
          LinkedIn
        </a>
        <a
          href="/rss.xml"
          class="px-4 py-2 text-sm border border-border rounded-full text-text-muted hover:text-accent hover:border-accent transition-colors"
        >
          RSS
        </a>
      </nav>
    </section>
  </div>
</Layout>
